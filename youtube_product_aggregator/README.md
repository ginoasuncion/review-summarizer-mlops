# YouTube Product Aggregator

A Cloud Run service that automatically aggregates multiple YouTube video reviews of the same product into comprehensive, unified summaries. This service is triggered when new individual video summaries are uploaded to the storage bucket.

## ğŸš€ Features

- **Intelligent Product Grouping**: Automatically identifies and groups videos reviewing the same product
- **Multi-Review Synthesis**: Combines multiple reviews into comprehensive product analysis
- **Brand Recognition**: Recognizes common shoe brands and product models
- **Comparative Analysis**: Provides insights across different reviewers and perspectives
- **Structured Output**: Generates organized summaries with key insights and recommendations
- **Automatic Triggering**: Listens to Cloud Storage events for new summary uploads

## ğŸ—ï¸ Architecture

```
Individual Video Summaries â†’ Product Aggregator â†’ Unified Product Reviews
```

1. **Individual Summaries**: Generated by the transcript summarizer service
2. **Product Aggregator**: Groups videos by product and creates unified summaries
3. **Product Reviews**: Comprehensive analysis combining multiple perspectives

## ğŸ“‹ What Gets Generated

For each product with multiple reviews, the aggregator creates:

### Product Summary
- **Product Overview**: What the product is and its main features
- **Consensus Analysis**: What most reviewers agree on (pros and cons)
- **Key Strengths**: Most commonly praised aspects
- **Common Concerns**: Frequently mentioned issues or drawbacks
- **Price-Performance**: Value for money assessment
- **Target Audience**: Who would benefit most from the product
- **Comparison Insights**: How it compares to alternatives
- **Overall Recommendation**: General consensus on whether to buy
- **Reviewer Credibility**: Diversity and expertise of reviewers

### Product Metadata
- Product name and identification
- Total number of reviews analyzed
- Total and average view counts
- List of reviewers and video IDs
- Processing timestamps
- Search queries that led to the product

## ğŸ” Product Recognition

The service uses intelligent pattern matching to identify products:

### Brand Recognition
- **Nike**: Air Max, Air Force, Jordan, etc.
- **Adidas**: Ultraboost, Samba, Stan Smith, etc.
- **Other Brands**: Puma, Reebok, Converse, Vans, New Balance, etc.

### Title Analysis
- Removes common words: "review", "unboxing", "test", "comparison"
- Extracts brand + model combinations
- Falls back to search query or title keywords

## ğŸ“ File Structure

```
youtube-processed-data-bucket/
â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ Adidas_Ultraboost_20241201_143022.txt          # Product summary
â”‚   â”œâ”€â”€ Adidas_Ultraboost_20241201_143022_metadata.json # Product metadata
â”‚   â”œâ”€â”€ Nike_Air_Max_20241201_143022.txt
â”‚   â””â”€â”€ Nike_Air_Max_20241201_143022_metadata.json
```

## ğŸš€ Deployment

### Prerequisites
- Google Cloud Project with billing enabled
- Docker installed and authenticated with GCR
- gcloud CLI configured

### Deploy
```bash
# Make script executable
chmod +x deploy.sh

# Deploy the service
./deploy.sh
```

### Environment Variables
- `GCP_PROJECT_ID`: Google Cloud Project ID
- `SOURCE_BUCKET`: Source bucket for video metadata and summaries
- `PRODUCTS_BUCKET`: Destination bucket for product summaries
- `OPENAI_API_KEY`: OpenAI API key for ChatGPT integration

## ğŸ“Š Example Output

### Product Summary
```
**Product Overview:**
The Adidas Ultraboost Light is the latest iteration in the Ultraboost line, featuring improved weight reduction and enhanced comfort compared to previous models.

**Consensus Analysis:**
Most reviewers agree that the Ultraboost Light offers:
- Improved comfort and lighter weight
- Better knit material and ankle cushioning
- High price point that may not justify upgrades from recent models

**Key Strengths:**
- Lightest Ultraboost ever made
- Enhanced comfort and cushioning
- Improved design and aesthetics
- Quality Boost technology

**Common Concerns:**
- High price point
- Incremental improvements over previous models
- May not justify upgrade for recent Ultraboost owners

**Overall Recommendation:**
The Ultraboost Light is recommended for new buyers or those with older Ultraboost models, but may not be worth the upgrade for recent Ultraboost 21/22 owners due to the high price point and incremental improvements.
```

### Product Metadata
```json
{
  "product_name": "Adidas Ultraboost Light",
  "summary_file": "gs://youtube-processed-data-bucket/products/Adidas_Ultraboost_Light_20241201_143022.txt",
  "total_reviews": 5,
  "total_views": 1250000,
  "average_views": 250000,
  "reviewers": ["Elliot Page", "Shoe Review Channel", "Running Expert"],
  "video_ids": ["3tUVJGDEFG0", "9B0sclu77Fk", "Bz1-KlL_buI"],
  "processed_at": "2024-12-01T14:30:22Z",
  "search_queries": ["Adidas Ultraboost review", "Ultraboost Light review"]
}
```

## ğŸ” Monitoring

### View Logs
```bash
gcloud logs tail --service=youtube-product-aggregator --region=us-central1
```

### Check Product Summaries
```bash
# List product summaries
gsutil ls gs://youtube-processed-data-bucket/products/

# View a product summary
gsutil cat gs://youtube-processed-data-bucket/products/Adidas_Ultraboost_Light_20241201_143022.txt
```

## ğŸ”§ Configuration

### Memory and CPU
- **Memory**: 2GB allocated for processing multiple reviews
- **CPU**: 2 vCPUs for faster analysis
- **Timeout**: 900 seconds for comprehensive processing
- **Max Instances**: 10 for auto-scaling

### Trigger Configuration
- Listens to `summaries/` folder in the source bucket
- Processes only files with `.txt` extension
- Requires multiple reviews (2+) for product aggregation

## ğŸ“ˆ Performance

- **Processing Time**: 30-60 seconds per product (depending on number of reviews)
- **Memory Usage**: 1-2GB during processing
- **Concurrency**: Handles multiple products simultaneously
- **Scalability**: Auto-scales based on demand

## ğŸ”„ Integration

This service integrates with the complete YouTube review pipeline:

1. **YouTube Search API** â†’ Raw search results
2. **Data Processor** â†’ Video metadata extraction
3. **Transcript Processor** â†’ Video transcript fetching
4. **Transcript Summarizer** â†’ Individual video summaries
5. **Product Aggregator** â†’ Unified product reviews âœ…

## ğŸ“ License

This project is part of the Review Summarizer MLOps pipeline. 